{#<!DOCTYPE html>#}
{#<html lang="en">#}
{#<head>#}
{#    <meta charset="UTF-8">#}
{#    <meta name="viewport" content="width=device-width, initial-scale=1.0">#}
{#    <title>Product Details</title>#}
{#</head>#}
{#<body>#}
{#    <div id="product-details">#}
{#        <h3>Product Details</h3>#}
{#        <p id="product-name">Product Name: </p>#}
{#        <p id="product-quantity">Quantity: </p>#}
{#        <p id="product-price">Price: </p> #}
{#        <p id="product-total">Total: </p> #}
{#        <a href="{% url 'accounts:login' %}"> test</a>#}
{#    </div>#}
{##}
{#    <script>#}
{#        // خواندن اطلاعات از لوکال استوریج#}
{#        const productId = localStorage.getItem('productId');#}
{#        const quantity = localStorage.getItem('quantity');#}
{##}
{#        // ارسال درخواست GET به سرور#}
{#        fetch(`/orders/product_list/?product_id=${productId}&quantity=${quantity}`, {#}
{#            method: 'GET',#}
{#            headers: {#}
{#                'Content-Type': 'application/json',#}
{#            },#}
{#        })#}
{#        .then(response => response.json())#}
{#        .then(data => {#}
{#            // نمایش اطلاعات به کاربر#}
{#            document.getElementById('product-name').innerText = `Product Name: ${data.product}`;#}
{#            document.getElementById('product-quantity').innerText = `Quantity: ${data.quantity}`;#}
{#            document.getElementById('product-price').innerText = `Price: ${data.price}`;#}
{#            document.getElementById('product-total').innerText = `Price: ${data.total}`;#}
{#        })#}
{#        .catch((error) => {#}
{#            console.error('Error:', error);#}
{#        });#}
{#    </script>#}
{#</body>#}
{#</html>#}
{#<!DOCTYPE html>#}
{#<html lang="en">#}
{#<head>#}
{#    <meta charset="UTF-8">#}
{#    <meta name="viewport" content="width=device-width, initial-scale=1.0">#}
{#    <title>Product Details</title>#}
{#</head>#}
{#<body>#}
{#<div id="product-details">#}
{#    <h3>Product Details</h3>#}
{#    <p id="product-name">Product Name: </p>#}
{#    <p id="product-quantity">Quantity: </p>#}
{#    <p id="product-price">Price: </p>#}
{#    <p id="product-total">Total Price: </p>#}
{#</div>#}
{##}
{#<form id="dataForm" method="post">#}
{#    <input type="hidden" id="product-id" name="product-id">#}
{#    <input type="hidden" id="quantity" name="quantity">#}
{#    <button type="submit">Submit</button>#}
{#</form>#}
{##}
{#<script>#}
{#    const productId = localStorage.getItem('productId');#}
{#    const quantity = localStorage.getItem('quantity');#}
{#    const url = `/orders/product_list/?product_id=${productId}&quantity=${quantity}`;#}
{#    console.log('URL:', url);#}
{##}
{#    fetch(url, {#}
{#        method: 'GET',#}
{#        headers: {#}
{#            'Content-Type': 'application/json',#}
{#        },#}
{#    })#}
{#        .then(response => response.json())#}
{#        .then(data => {#}
{#            console.log('Data:', data);#}
{#            document.getElementById('product-name').innerText = `Product Name: ${data.product}`;#}
{#            document.getElementById('product-quantity').innerText = `Quantity: ${data.quantity}`;#}
{#            document.getElementById('product-price').innerText = `Price: ${data.price}`;#}
{#            document.getElementById('product-total').innerText = `Total Price: ${data.total}`;#}
{##}
{#            // Set hidden form fields#}
{#            document.getElementById('product-id').value = data.product;#}
{#            document.getElementById('quantity').value = data.quantity;#}
{#        })#}
{#        .catch((error) => {#}
{#            console.error('Error:', error);#}
{#        });#}
{##}
{#    document.getElementById('dataForm').addEventListener('submit', function (event) {#}
{#        event.preventDefault();#}
{##}
{#        const productId = document.getElementById('product-id').value;#}
{#        const quantity = document.getElementById('quantity').value;#}
{##}
{#        // Check if user is authenticated#}
{#        fetch('{% url 'orders:api:is_authenticated' %}', {#}
{#            method: 'GET',#}
{#            headers: {#}
{#                'Content-Type': 'application/json',#}
{#            },#}
{#        })#}
{#            .then(response => response.json())#}
{#            .then(data => {#}
{#                if (data.is_authenticated) {#}
{#                    // User is authenticated, proceed with order creation#}
{#                    fetch('{% url "orders:api:create_order" %}', {#}
{#                        method: 'POST',#}
{#                        headers: {#}
{#                            'Content-Type': 'application/json',#}
{#                            'X-CSRFToken': '{{ csrf_token }}'#}
{#                        },#}
{#                        body: JSON.stringify({ id: productId, number: quantity })#}
{#                    })#}
{#                        .then(response => response.json())#}
{#                        .then(data => console.log(data))#}
{#                        .catch(error => console.error('Error:', error));#}
{#                } else {#}
{#                    // User is not authenticated, redirect to login#}
{#                    localStorage.setItem('productId', productId);#}
{#                    localStorage.setItem('quantity', quantity);#}
{#                    window.location.href = `{% url 'accounts:login' %}?next={% url 'orders:api:create_order' %}`;#}
{#                }#}
{#            })#}
{#            .catch(error => console.error('Error:', error));#}
{#    });#}
{##}
{#    // Check if redirected from login and submit order#}
{#    if (window.location.search.includes('next=')) {#}
{#        const storedProductId = localStorage.getItem('productId');#}
{#        const storedQuantity = localStorage.getItem('quantity');#}
{#        if (storedProductId && storedQuantity) {#}
{#            fetch('{% url "orders:api:create_order" %}', {#}
{#                method: 'POST',#}
{#                headers: {#}
{#                    'Content-Type': 'application/json',#}
{#                    'X-CSRFToken': '{{ csrf_token }}'#}
{#                },#}
{#                body: JSON.stringify({ id: storedProductId, number: storedQuantity })#}
{#            })#}
{#                .then(response => response.json())#}
{#                .then(data => {#}
{#                    console.log(data);#}
{#                    localStorage.removeItem('productId');#}
{#                    localStorage.removeItem('quantity');#}
{#                })#}
{#                .catch(error => console.error('Error:', error));#}
{#        }#}
{#    }#}
{#</script>#}
{#</body>#}
{#</html>#}
<!-- template.html -->

<!-- template.html -->

{#<!DOCTYPE html>#}
{#<html lang="en">#}
{#<head>#}
{#    <meta charset="UTF-8">#}
{#    <meta name="viewport" content="width=device-width, initial-scale=1.0">#}
{#    <title>Product Details</title>#}
{#</head>#}
{#<body>#}
{#<div id="product-details">#}
{#    <h3>Product Details</h3>#}
{#    <p id="product-id">Product ID: </p>#}
{#    <p id="product-name">Product Name: </p>#}
{#    <p id="product-quantity">Quantity: </p>#}
{#    <p id="product-price">Price: </p>#}
{#    <p id="product-total">Total Price: </p>#}
{#</div>#}
{##}
{#{% if not request.user.is_authenticated %}#}
{#    #}
{#    <a href="#"> login</a>#}
{#    {% else %}#}
{#    #}
{#    <form id="dataForm" method="post">#}
{#    <input type="hidden" id="product-id" name="product-id">#}
{#    <input type="hidden" id="quantity" name="quantity">#}
{#    <button type="submit">Submit</button>#}
{#</form>#}
{#{% endif %}#}
{##}
{##}
{##}
{#<script>#}
{#    const productId = localStorage.getItem('productId');#}
{#    const quantity = localStorage.getItem('quantity');#}
{#    const url = `/orders/product_list/?product_id=${productId}&quantity=${quantity}`;#}
{#    console.log('URL:', url);#}
{##}
{#    fetch(url, {#}
{#        method: 'GET',#}
{#        headers: {#}
{#            'Content-Type': 'application/json',#}
{#        },#}
{#    })#}
{#        .then(response => response.json())#}
{#        .then(data => {#}
{#            console.log('Data:', data);#}
{#            document.getElementById('product-id').innerText = `Product ID: ${data.product_id}`;#}
{#            document.getElementById('product-name').innerText = `Product Name: ${data.product}`;#}
{#            document.getElementById('product-quantity').innerText = `Quantity: ${data.quantity}`;#}
{#            document.getElementById('product-price').innerText = `Price: ${data.price}`;#}
{#            document.getElementById('product-total').innerText = `Total Price: ${data.total}`;#}
{##}
{#            // Set hidden form fields#}
{#            document.getElementById('product-id').value = data.product_id;#}
{#            document.getElementById('quantity').value = data.quantity;#}
{#        })#}
{#        .catch((error) => {#}
{#            console.error('Error:', error);#}
{#        });#}
{##}
{#    document.getElementById('dataForm').addEventListener('submit', function (event) {#}
{#        event.preventDefault();#}
{##}
{#        const productId = document.getElementById('product-id').value;#}
{#        const quantity = document.getElementById('quantity').value;#}
{##}
{#        // Check if user is authenticated#}
{#        fetch('{% url 'orders:api:is_authenticated' %}', {#}
{#            method: 'GET',#}
{#            headers: {#}
{#                'Content-Type': 'application/json',#}
{#            },#}
{#        })#}
{#            .then(response => response.json())#}
{#            .then(data => {#}
{#                if (data.is_authenticated) {#}
{#                    // User is authenticated, proceed with order creation#}
{#                    window.location.href = `/orders/api/order_create/${productId}/${quantity}/`;#}
{#                } else {#}
{#                    // User is not authenticated, redirect to login#}
{#                    localStorage.setItem('productId', productId);#}
{#                    localStorage.setItem('quantity', quantity);#}
{#                    window.location.href = `{% url 'accounts:login' %}?next=/orders/api/order_create/${productId}/${quantity}/`;#}
{#                }#}
{#            })#}
{#            .catch(error => console.error('Error:', error));#}
{#    });#}
{##}
{#    // Check if redirected from login and submit order#}
{#    if (window.location.search.includes('next=')) {#}
{#        const storedProductId = localStorage.getItem('productId');#}
{#        const storedQuantity = localStorage.getItem('quantity');#}
{#        if (storedProductId && storedQuantity) {#}
{#            window.location.href = `/orders/order_create/${storedProductId}/${storedQuantity}/`;#}
{#            localStorage.removeItem('productId');#}
{#            localStorage.removeItem('quantity');#}
{#        }#}
{#    }#}
{#</script>#}
{#</body>#}
{#</html>#}
{#<!DOCTYPE html>#}
{#<html lang="en">#}
{#<head>#}
{#    <meta charset="UTF-8">#}
{#    <meta name="viewport" content="width=device-width, initial-scale=1.0">#}
{#    <title>Product Details</title>#}
{#</head>#}
{#<body>#}
{#<div id="product-details">#}
{#    <h3>Product Details</h3>#}
{#    <p id="product-id">Product ID: </p>#}
{#    <p id="product-name">Product Name: </p>#}
{#    <p id="product-quantity">Quantity: </p>#}
{#    <p id="product-price">Price: </p>#}
{#    <p id="product-total">Total Price: </p>#}
{#</div>#}
{##}
{#{% if not request.user.is_authenticated %}#}
{#    <a href="{% url 'accounts:login' %}">Login</a>#}
{#{% else %}#}
{#    <form id="dataForm" method="post">#}
{#        <input type="hidden" id="product-id" name="product-id">#}
{#        <input type="hidden" id="quantity" name="quantity">#}
{#        <button type="submit">Submit</button>#}
{#    </form>#}
{#{% endif %}#}
{##}
{#<script>#}
{#    const productId = localStorage.getItem('productId');#}
{#    const quantity = localStorage.getItem('quantity');#}
{#    const url = `/orders/product_list/?product_id=${productId}&quantity=${quantity}`;#}
{#    console.log('URL:', url);#}
{##}
{#    fetch(url, {#}
{#        method: 'GET',#}
{#        headers: {#}
{#            'Content-Type': 'application/json',#}
{#        },#}
{#    })#}
{#        .then(response => response.json())#}
{#        .then(data => {#}
{#            console.log('Data:', data);#}
{#            document.getElementById('product-id').innerText = `Product ID: ${data.product_id}`;#}
{#            document.getElementById('product-name').innerText = `Product Name: ${data.product}`;#}
{#            document.getElementById('product-quantity').innerText = `Quantity: ${data.quantity}`;#}
{#            document.getElementById('product-price').innerText = `Price: ${data.price}`;#}
{#            document.getElementById('product-total').innerText = `Total Price: ${data.total}`;#}
{##}
{#            // Set hidden form fields#}
{#            document.getElementById('product-id').value = data.product_id;#}
{#            document.getElementById('quantity').value = data.quantity;#}
{#        })#}
{#        .catch((error) => {#}
{#            console.error('Error:', error);#}
{#        });#}
{##}
{#    document.getElementById('dataForm').addEventListener('submit', function (event) {#}
{#        event.preventDefault();#}
{##}
{#        const productId = document.getElementById('product-id').value;#}
{#        const quantity = document.getElementById('quantity').value;#}
{##}
{#        // Check if user is authenticated#}
{#        fetch('{% url 'orders:api:is_authenticated' %}', {#}
{#            method: 'GET',#}
{#            headers: {#}
{#                'Content-Type': 'application/json',#}
{#            },#}
{#        })#}
{#            .then(response => response.json())#}
{#            .then(data => {#}
{#                if (data.is_authenticated) {#}
{#                    // User is authenticated, proceed with order creation#}
{#                    window.location.href = `/orders/create_order/${productId}/${quantity}/`;#}
{#                } else {#}
{#                    // User is not authenticated, redirect to login#}
{#                    localStorage.setItem('productId', productId);#}
{#                    localStorage.setItem('quantity', quantity);#}
{#                    window.location.href = `/orders/create_order/${productId}/${quantity}/`;#}
{#                }#}
{#            })#}
{#            .catch(error => console.error('Error:', error));#}
{#    });#}
{##}
{#    // Check if redirected from login and submit order#}
{#    if (window.location.search.includes('next=')) {#}
{#        const storedProductId = localStorage.getItem('productId');#}
{#        const storedQuantity = localStorage.getItem('quantity');#}
{#        if (storedProductId && storedQuantity) {#}
{#            window.location.href = `/orders/create_order/${storedProductId}/${storedQuantity}/`;#}
{#            localStorage.removeItem('productId');#}
{#            localStorage.removeItem('quantity');#}
{#        }#}
{#    }#}
{#</script>#}
{#</body>#}
{#</html>#}
{##}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details</title>
</head>
<body>
<div id="product-details">
    <h3>Product Details</h3>
    <p id="product-id">Product ID: </p>
    <p id="product-name">Product Name: </p>
    <p id="product-quantity">Quantity: </p>
    <p id="product-price">Price: </p>
    <p id="product-total">Total Price: </p>
</div>

{% if not request.user.is_authenticated %}
    <a href="{% url 'orders:api:login' %}?next={{ request.path }}">Login</a>
{% else %}
    <form id="dataForm" method="post">
        <input type="hidden" id="product-id" name="product-id">
        <input type="hidden" id="quantity" name="quantity">
        <button type="submit">Submit</button>
    </form>
{% endif %}

<script>
    const productId = localStorage.getItem('productId');
    const quantity = localStorage.getItem('quantity');
    const url = `/orders/product_list/?product_id=${productId}&quantity=${quantity}`;
    console.log('URL:', url);

    fetch(url, {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json',
        },
    })
        .then(response => response.json())
        .then(data => {
            console.log('Data:', data);
            document.getElementById('product-id').innerText = `Product ID: ${data.product_id}`;
            document.getElementById('product-name').innerText = `Product Name: ${data.product}`;
            document.getElementById('product-quantity').innerText = `Quantity: ${data.quantity}`;
            document.getElementById('product-price').innerText = `Price: ${data.price}`;
            document.getElementById('product-total').innerText = `Total Price: ${data.total}`;

            // Set hidden form fields
            document.getElementById('product-id').value = data.product_id;
            document.getElementById('quantity').value = data.quantity;
        })
        .catch((error) => {
            console.error('Error:', error);
        });

    document.getElementById('dataForm').addEventListener('submit', function (event) {
        event.preventDefault();

        const productId = document.getElementById('product-id').value;
        const quantity = document.getElementById('quantity').value;

        // Directly go to create order URL
        window.location.href = `/orders/create_order/${productId}/${quantity}/`;
    });
</script>
</body>
</html>

